---
title: "HTTPS: CA证书验证"
date: 2023-12-27 19:41:29
tags: [https,http,ssl]
categories: "理解计算机"
---

在当今数字化的世界中，信息的安全性至关重要。无论是在线购物、银行交易还是简单的网页浏览，我们都依赖于安全的通信渠道来保护我们的敏感信息。而在这个保护信息的背后，CA证书扮演着至关重要的角色。

## 什么是CA证书？

CA（证书颁发机构）是一个可信任的第三方实体，负责验证和签发数字证书。数字证书本质上是一种由CA签名的文件，用于确认在网络通信中各方的身份。

CA证书包含两个主要部分：一是网站信息，二是数字签名。

- 网站信息通常包括域名、有效期、公钥、证书颁发者等。
- 数字签名是由网站信息的哈希值通过证书颁发者的**私钥加密**而来。

这两部分合起来构成了一个数字证书。

证书签发流程大致如下:

![CA证书签发流程](/posts_data/ca-1.png)

<!-- more -->

## 证书校验

在签发证书的过程中，数字签名是由证书颁发者使用私钥对网站信息进行加密得到的。根据非对称加密的特性，证书的验证流程如下:

1. 网站信息经过摘要计算得到一个哈希值。
2. 数字签名经过证书颁发者的**公钥解密**得到一个哈希值。

这两个哈希值应该是相同的，如果相同则表示校验通过，证书是可信的。

> [查看非对称加密原理](https://www.winn.cc/2022/07/04/rsa/)

证书验证流程大致如下:

![CA证书验证流程](/posts_data/ca-2.png)

## 证书链验证

在证书验证的过程中，我们必须要知道证书颁发者的公钥。通常，操作系统中预装了一些根证书。如果我们访问的网站的证书是由根证书机构签发的，我们直接使用根证书的公钥来进行验证即可。

然而，并非所有的网站证书都是由根证书机构进行签发的，而是一级一级往下签发的，流程大致如下:

![CA证书链验证](/posts_data/ca-3.png)

在访问网站时，服务器会将中间的1,2,3级证书都一起发送给我们。我们通过3级证书的颁发者（即二级证书）的公钥，对三级证书进行验证，然后再通过二级证书的颁发者（即一级证书）的公钥对二级证书进行验证，以此类推，直到验证到最顶层。接着，检查最顶层证书的颁发者是否在根证书之中，并用根证书进行最终的验证。如果验证通过，整个证书链都是可信的。